---
layout: home
---

<script src="{{ 'pako/dist/pako.js' | node_module_url | relative_url }}"></script>
<script src="{{ 'js-base64/base64.js' | node_module_url | relative_url }}"></script>

{%- assign textarea_id = 'textarea' -%}
{%- capture textarea_placeholder -%}
{{ site.tagline }}.

{{ site.description }}

- Doesn't need cookies = immune to data loss by accident
- Doesn't use a server = no downtimes
- Doesn't use analytics = respects your privacy

---

One example use case is this:
- You start working on a new project.
- You open a new browser window / tab group for this.
- You open a {{ site.title | downcase }} to write down to do lists, ideas, reminders, etc.
- You safely close and reopen the browser or power off and restart your machine when needed.
- You get it synced to your other devices in supported browsers and update the notes on the go.

{%- endcapture -%}

<textarea id="{{ textarea_id }}" placeholder="{{ textarea_placeholder }}" autofocus></textarea>

<script>
    function main() {
        if (document.readyState !== 'loading') {
            document.addEventListener('DOMContentLoaded', run);
        } else {
            run();
        }
    }

    function run() {
        const textarea = document.getElementById('{{ textarea_id }}');
        loadValue(textarea);
        addValueListener(textarea);
        addFocusListener(textarea);
        addHashListener(textarea);
    }

    function loadValue(textarea) {
        const value = retrieveValue();
        const oldValue = textarea.value;
        textarea.value = value;
        if (oldValue === '') {
            textarea.selectionStart = value.length;
        }
        updateTitle(value);
    }

    function addValueListener(textarea) {
        let timeout;
        textarea.addEventListener('input', (event) => {
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                const value = event.target.value;
                storeValue(value);
                updateTitle(value);
            }, 3000);
        }, false);
    }

    function addFocusListener(textarea) {
        textarea.addEventListener('blur', () => {
            const value = textarea.value;
            storeValue(value);
            updateTitle(value);
        }, false);

        window.addEventListener('blur', () => {
            const value = textarea.value;
            storeValue(value);
            updateTitle(value);
        }, false);
    }

    function addHashListener(textarea) {
        window.addEventListener('hashchange', () => {
            loadValue(textarea);
        });
    }

    function retrieveValue() {
        const hash = window.location.hash;
        if (hash === '') { return ''; }
        return deserialize(hash.substring(1));
    }

    function storeValue(value) {
        window.location.hash = '#' + serialize(value);
    }

    function serialize(value) {
        if (value === '') { return ''; }
        const data = new TextEncoder().encode(value);
        const compressed = pako.deflate(data, { level: 9 });
        return Base64.fromUint8Array(compressed, true);
    }

    function deserialize(value) {
        const data = Base64.toUint8Array(value);
        return pako.inflate(data, { to: 'string' });
    }

    function updateTitle(value) {
        const firstLine = value.split('\n')[0].trim();
        if (firstLine) {
            document.title = firstLine;
        } else {
            document.title = '{{ site.tagline }}';
        }
    }

    main();
</script>
